document.addEventListener("DOMContentLoaded", () => {

    function inicializarBotaoVoltar() {
        const btnVoltar = document.querySelector(".seta_voltar");
        if (btnVoltar) {
            btnVoltar.addEventListener("click", () => {
                history.back();
            });
        }
    }

    function inicializarCards() {
        const cards = document.querySelectorAll(".card-pontos-turistico");

        cards.forEach(card => {
            card.style.transition = "all 0.3s ease";
            card.style.cursor = "pointer";

            const btnConfira = card.querySelector(".botao_oferta");
            const titulo = card.querySelector("h3").textContent;

            card.addEventListener("mouseover", () => {
                card.style.transform = "translateY(-10px)";
                card.style.boxShadow = "0 10px 25px rgba(0, 0, 0, 0.15)";
            });

            card.addEventListener("mouseout", () => {
                card.style.transform = "translateY(0)";
                card.style.boxShadow = "none";
            });

            btnConfira.addEventListener("click", (e) => {
                e.stopPropagation();
                navegarParaDetalhes(titulo);
            });

            card.addEventListener("click", () => {
                navegarParaDetalhes(titulo);
            });
        });
    }

    function navegarParaDetalhes(nomeLugar) {
        const mapa = {
            "SÃ£o joÃ£o de Caruaru": "alto do moura",
            "Serra dos Cavalos": "serra dos cavalos",
            "Morro Bom Jesus": "morro bom jesus",
            "Alto do Moura": "alto do moura",
            "Feira de Caruaru": "feira de caruaru"
        };

        const pagina = mapa[nomeLugar];
        if (pagina) {
            window.location.href = `${pagina}.html`;
        }
    }

    function inicializarAvaliacao() {
        const avaliacoes = document.querySelectorAll(".avaliaÃ§ao");

        avaliacoes.forEach(avaliacao => {
            const texto = avaliacao.textContent;
            const estrelas = parseInt(texto.match(/\d+\.\d+/)[0]);

            if (estrelas >= 4.8) {
                avaliacao.style.color = "#FFD700";
            } else if (estrelas >= 4.3) {
                avaliacao.style.color = "#FFA500";
            } else {
                avaliacao.style.color = "#FF6B6B";
            }

            avaliacao.style.fontWeight = "bold";
        });
    }

    function inicializarFiltroAvaliacoes() {
        const container = document.querySelector(".cards-pontos-turisticos");
        const controle = document.createElement("div");
        controle.className = "filtro-avaliacoes";
        controle.style.cssText = `
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        `;

        const opcoes = [
            { label: "Todos", valor: 0 },
            { label: "â­ 5.0", valor: 5 },
            { label: "â­ 4.5+", valor: 4.5 },
            { label: "â­ 4.0+", valor: 4 }
        ];

        opcoes.forEach(opcao => {
            const btn = document.createElement("button");
            btn.textContent = opcao.label;
            btn.style.cssText = `
                padding: 8px 16px;
                border: 2px solid #ddd;
                background: white;
                border-radius: 20px;
                cursor: pointer;
                transition: all 0.3s;
                font-weight: 500;
            `;

            if (opcao.valor === 0) {
                btn.classList.add("ativo");
                btn.style.background = "#FF6B35";
                btn.style.color = "white";
                btn.style.borderColor = "#FF6B35";
            }

            btn.addEventListener("click", () => {
                document.querySelectorAll(".filtro-avaliacoes button").forEach(b => {
                    b.style.background = "white";
                    b.style.color = "#333";
                    b.style.borderColor = "#ddd";
                    b.classList.remove("ativo");
                });

                btn.classList.add("ativo");
                btn.style.background = "#FF6B35";
                btn.style.color = "white";
                btn.style.borderColor = "#FF6B35";

                filtrarPorAvaliacao(opcao.valor);
            });

            controle.appendChild(btn);
        });

        container.parentElement.insertBefore(controle, container);
    }

    function filtrarPorAvaliacao(minimo) {
        const cards = document.querySelectorAll(".card-pontos-turistico");

        cards.forEach(card => {
            const avaliacaoTexto = card.querySelector(".avaliaÃ§ao").textContent;
            const estrelas = parseFloat(avaliacaoTexto.match(/\d+\.\d+/)[0]);

            if (minimo === 0 || estrelas >= minimo) {
                card.style.display = "block";
                card.style.animation = "fadeIn 0.3s";
            } else {
                card.style.display = "none";
            }
        });
    }

    function inicializarBuscaPorNome() {
        const header = document.querySelector("header");
        const barraAbusca = document.createElement("input");
        barraAbusca.type = "text";
        barraAbusca.placeholder = "Buscar ponto turÃ­stico...";
        barraAbusca.style.cssText = `
            width: 90%;
            max-width: 400px;
            padding: 10px 15px;
            margin: 15px auto;
            display: block;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            transition: 0.3s;
        `;

        barraAbusca.addEventListener("focus", () => {
            barraAbusca.style.borderColor = "#FF6B35";
            barraAbusca.style.boxShadow = "0 0 10px rgba(255, 107, 53, 0.2)";
        });

        barraAbusca.addEventListener("blur", () => {
            barraAbusca.style.borderColor = "#ddd";
            barraAbusca.style.boxShadow = "none";
        });

        barraAbusca.addEventListener("input", (e) => {
            const termo = e.target.value.toLowerCase();
            const cards = document.querySelectorAll(".card-pontos-turistico");

            cards.forEach(card => {
                const titulo = card.querySelector("h3").textContent.toLowerCase();
                if (titulo.includes(termo) || termo === "") {
                    card.style.display = "block";
                    card.style.animation = "fadeIn 0.3s";
                } else {
                    card.style.display = "none";
                }
            });
        });

        header.appendChild(barraAbusca);
    }

    function inicializarOrdenacao() {
        const container = document.querySelector(".cards-pontos-turisticos");
        const controleOrdenacao = document.createElement("div");
        controleOrdenacao.className = "ordenacao";
        controleOrdenacao.style.cssText = `
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
            flex-wrap: wrap;
        `;

        const opcoes = [
            { label: "Mais Popular", tipo: "popular" },
            { label: "Melhor Avaliado", tipo: "avaliacao" },
            { label: "HorÃ¡rio (Mais Cedo)", tipo: "horario" }
        ];

        opcoes.forEach(opcao => {
            const btn = document.createElement("button");
            btn.textContent = opcao.label;
            btn.style.cssText = `
                padding: 8px 16px;
                border: 2px solid #ddd;
                background: white;
                border-radius: 20px;
                cursor: pointer;
                transition: all 0.3s;
                font-weight: 500;
            `;

            btn.addEventListener("click", () => {
                ordenarCards(opcao.tipo);
                document.querySelectorAll(".ordenacao button").forEach(b => {
                    b.style.background = "white";
                    b.style.borderColor = "#ddd";
                });
                btn.style.background = "#FF6B35";
                btn.style.color = "white";
                btn.style.borderColor = "#FF6B35";
            });

            controleOrdenacao.appendChild(btn);
        });

        container.parentElement.insertBefore(controleOrdenacao, container);
    }

    function ordenarCards(tipo) {
        const container = document.querySelector(".cards-pontos-turisticos");
        const cards = Array.from(container.querySelectorAll(".card-pontos-turistico"));

        if (tipo === "avaliacao") {
            cards.sort((a, b) => {
                const avalA = parseFloat(a.querySelector(".avaliaÃ§ao").textContent.match(/\d+\.\d+/)[0]);
                const avalB = parseFloat(b.querySelector(".avaliaÃ§ao").textContent.match(/\d+\.\d+/)[0]);
                return avalB - avalA;
            });
        } else if (tipo === "horario") {
            cards.sort((a, b) => {
                const horarioA = a.querySelector(".beneficios").textContent;
                const horarioB = b.querySelector(".beneficios").textContent;
                return horarioA.localeCompare(horarioB);
            });
        }

        cards.forEach(card => {
            container.appendChild(card);
            card.style.animation = "slideIn 0.3s";
        });
    }

    function inicializarFavoritos() {
        const cards = document.querySelectorAll(".card-pontos-turistico");

        cards.forEach(card => {
            const titulo = card.querySelector("h3").textContent;
            const btnFav = document.createElement("button");
            btnFav.className = "btn-favoritar";
            btnFav.style.cssText = `
                position: absolute;
                top: 10px;
                right: 10px;
                background: rgba(255, 255, 255, 0.9);
                border: none;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                font-size: 20px;
                cursor: pointer;
                transition: all 0.2s;
                z-index: 10;
            `;

            const isFavorito = verificarFavorito(titulo);
            btnFav.textContent = isFavorito ? "â¤ï¸" : "ðŸ¤";

            btnFav.addEventListener("mouseover", () => {
                btnFav.style.transform = "scale(1.2)";
                btnFav.style.background = "rgba(255, 107, 53, 0.9)";
            });

            btnFav.addEventListener("mouseout", () => {
                btnFav.style.transform = "scale(1)";
                btnFav.style.background = "rgba(255, 255, 255, 0.9)";
            });

            btnFav.addEventListener("click", (e) => {
                e.stopPropagation();
                const novoEstado = !verificarFavorito(titulo);
                salvarFavorito(titulo, novoEstado);
                btnFav.textContent = novoEstado ? "â¤ï¸" : "ðŸ¤";
            });

            card.style.position = "relative";
            card.appendChild(btnFav);
        });
    }

    function verificarFavorito(nome) {
        const favoritos = JSON.parse(localStorage.getItem("favoritosPontos")) || [];
        return favoritos.includes(nome);
    }

    function salvarFavorito(nome, favoritar) {
        let favoritos = JSON.parse(localStorage.getItem("favoritosPontos")) || [];

        if (favoritar) {
            if (!favoritos.includes(nome)) {
                favoritos.push(nome);
            }
        } else {
            favoritos = favoritos.filter(f => f !== nome);
        }

        localStorage.setItem("favoritosPontos", JSON.stringify(favoritos));
    }

    function adicionarAnimacoes() {
        const style = document.createElement("style");
        style.textContent = `
            @keyframes fadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);
    }

    function inicializarSistema() {
        adicionarAnimacoes();
        inicializarBotaoVoltar();
        inicializarCards();
        inicializarAvaliacao();
        inicializarFiltroAvaliacoes();
        inicializarBuscaPorNome();
        inicializarOrdenacao();
        inicializarFavoritos();
    }

    inicializarSistema();

});